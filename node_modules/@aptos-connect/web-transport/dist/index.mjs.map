{"version":3,"sources":["../src/index.ts","../src/prompt.ts","../src/state.ts","../src/telegram/openTelegramPrompt.ts","../src/telegram/createWalletRequest.ts","../src/telegram/getClientIdentityKey.ts","../src/telegram/getWalletResponse.ts","../src/telegram/smartPolling.ts","../src/telegram/index.ts"],"sourcesContent":["// Copyright © Aptos\n// SPDX-License-Identifier: Apache-2.0\n\nimport {\n  ConnectRequest,\n  ConnectResponse,\n  DisconnectRequest,\n  DisconnectResponse,\n  GetConnectedAccountsRequest,\n  GetConnectedAccountsResponse,\n  IsConnectedRequest,\n  IsConnectedResponse,\n  SerializedWalletRequest,\n  SignAndSubmitTransactionRequest,\n  SignInRequest,\n  SignInResponse,\n  SignMessageRequest,\n  SignTransactionRequest,\n} from '@aptos-connect/wallet-api';\nimport { openPrompt, waitForPromptResponse } from './prompt';\nimport {\n  addConnectedAccount,\n  getConnectedAccounts,\n  removeConnectedAccount,\n} from './state';\n\nimport { isTelegramMiniApp, openTelegramPrompt } from './telegram';\n\nexport class WebWalletTransport {\n  constructor(\n    private readonly baseUrl: string,\n    private readonly provider: 'google' | 'apple' | 'generic' = 'google',\n    private readonly tgWebAppUrl?: string,\n  ) {\n    this.baseUrl = baseUrl;\n  }\n\n  async sendPromptRequest(request: SerializedWalletRequest) {\n    if (isTelegramMiniApp()) {\n      return openTelegramPrompt({\n        baseUrl: this.baseUrl,\n        provider: this.provider,\n        request,\n        tgWebAppUrl: this.tgWebAppUrl,\n      });\n    }\n\n    const url = new URL(`${this.baseUrl}/prompt/`);\n    url.searchParams.set('provider', this.provider);\n    const prompt = openPrompt(url);\n\n    return waitForPromptResponse(this.baseUrl, prompt, request);\n  }\n\n  async sendRequest(request: SerializedWalletRequest) {\n    switch (request.name) {\n      case IsConnectedRequest.name: {\n        const connectedAccounts = getConnectedAccounts();\n        return IsConnectedResponse.serialize(connectedAccounts.length > 0);\n      }\n      case GetConnectedAccountsRequest.name: {\n        const connectedAccounts = getConnectedAccounts();\n        return GetConnectedAccountsResponse.serialize(connectedAccounts);\n      }\n      case ConnectRequest.name: {\n        const serializedResponse = await this.sendPromptRequest(request);\n        const response = ConnectResponse.deserialize(serializedResponse);\n        if (response.args.status === 'approved') {\n          const { account, pairing } = response.args.args;\n          if (pairing === undefined) {\n            addConnectedAccount(account);\n          }\n        }\n        return serializedResponse;\n      }\n      case SignInRequest.name: {\n        const serializedResponse = await this.sendPromptRequest(request);\n        const response = SignInResponse.deserialize(\n          serializedResponse,\n          request.version === 1 ? 1 : 2,\n        );\n        if (response.args.status === 'approved') {\n          const { account } = response.args.args;\n          addConnectedAccount(account);\n        }\n        return serializedResponse;\n      }\n      case DisconnectRequest.name: {\n        const [activeAccount] = getConnectedAccounts();\n        if (activeAccount) {\n          removeConnectedAccount(activeAccount.address);\n        }\n        return DisconnectResponse.serialize({});\n      }\n      case SignMessageRequest.name:\n      case SignTransactionRequest.name:\n      case SignAndSubmitTransactionRequest.name: {\n        return this.sendPromptRequest(request);\n      }\n      default: {\n        throw new Error('Unexpected request');\n      }\n    }\n  }\n}\n","// Copyright © Aptos\n// SPDX-License-Identifier: Apache-2.0\n\nimport {\n  ConnectResponse,\n  isTypedMessage,\n  PromptApprovalResponseMessage,\n  PromptConnectionRequestMessage,\n  PromptConnectionResponseMessage,\n  PromptUnauthorizedErrorMessage,\n  SerializedWalletRequest,\n  SerializedWalletResponse,\n} from '@aptos-connect/wallet-api';\n\nconst DEFAULT_PROMPT_SIZE = { height: 695, width: 465 };\nconst PROMPT_POLLER_INTERVAL = 500;\n\nconst dismissalSerializedResponse = ConnectResponse.serialize({\n  status: 'dismissed',\n});\n\nexport class PromptUnauthorizedError extends Error {\n  constructor() {\n    super('Unauthorized');\n  }\n}\n\nexport function openPrompt(url: string | URL, size = DEFAULT_PROMPT_SIZE) {\n  const { height, width } = size;\n  const options = {\n    height,\n    left: window.screenLeft + Math.round((window.outerWidth - width) / 2),\n    popup: true,\n    top: window.screenTop + Math.round((window.outerHeight - height) / 2),\n    width,\n  };\n\n  const strOptions = Object.entries(options)\n    .map(([key, value]) => `${key}=${JSON.stringify(value)}`)\n    .reduce((acc, entry) => `${acc}, ${entry}`);\n\n  const href = url instanceof URL ? url.href : url;\n  const promptWindow = window.open(href, undefined, strOptions);\n  if (promptWindow === null) {\n    throw new Error(\"Couldn't open prompt\");\n  }\n\n  return promptWindow;\n}\n\nexport async function waitForPromptResponse(\n  baseUrl: string,\n  promptWindow: Window,\n  request: SerializedWalletRequest,\n) {\n  return new Promise<SerializedWalletResponse>((resolve, reject) => {\n    const listeners = {\n      onMessage: (message: MessageEvent) => {\n        // Ignore messages from untrusted sources\n        if (message.source !== promptWindow || message.origin !== baseUrl) {\n          return;\n        }\n        if (isTypedMessage(PromptUnauthorizedErrorMessage, message.data)) {\n          window.removeEventListener('message', listeners.onMessage);\n          clearTimeout(listeners.promptPollerId);\n          reject(new PromptUnauthorizedError());\n          return;\n        }\n        if (isTypedMessage(PromptConnectionRequestMessage, message.data)) {\n          promptWindow.postMessage(\n            new PromptConnectionResponseMessage(request),\n            baseUrl,\n          );\n          return;\n        }\n        if (isTypedMessage(PromptApprovalResponseMessage, message.data)) {\n          window.removeEventListener('message', listeners.onMessage);\n          clearTimeout(listeners.promptPollerId);\n          resolve(message.data.serializedValue);\n        }\n      },\n      promptPollerId: setInterval(() => {\n        if (promptWindow.closed) {\n          window.removeEventListener('message', listeners.onMessage);\n          clearTimeout(listeners.promptPollerId);\n          resolve(dismissalSerializedResponse);\n        }\n      }, PROMPT_POLLER_INTERVAL),\n    };\n\n    window.addEventListener('message', listeners.onMessage);\n  });\n}\n","// Copyright © Aptos\n// SPDX-License-Identifier: Apache-2.0\n\nimport {\n  AccountInfo,\n  base64ToBytes,\n  bytesToBase64,\n  deserializeAccountInfo,\n  serializeAccountInfo,\n} from '@aptos-connect/wallet-api';\nimport { AccountAddress, Deserializer, Serializer } from '@aptos-labs/ts-sdk';\n\nconst localDappStateKey = '@aptos-connect/dapp-local-state';\n\n/**\n * Local dapp state loosely synced with the web wallet's state.\n * Due to browser restrictions (storage partitioning), it's no longer possible\n * to access the web wallet's state.\n */\ninterface DappLocalState {\n  connectedAccounts: AccountInfo[];\n}\n\nfunction serializeLocalDappState(state: DappLocalState): Uint8Array {\n  const serializer = new Serializer();\n  serializer.serializeU32AsUleb128(state.connectedAccounts.length);\n  for (const account of state.connectedAccounts) {\n    serializeAccountInfo(serializer, account);\n  }\n  return serializer.toUint8Array();\n}\n\nfunction deserializeLocalDappState(\n  serializedValue: Uint8Array,\n): DappLocalState {\n  const deserializer = new Deserializer(serializedValue);\n  const connectedAccountsLength = deserializer.deserializeUleb128AsU32();\n  const connectedAccounts: AccountInfo[] = [];\n  for (let i = 0; i < connectedAccountsLength; i += 1) {\n    connectedAccounts.push(deserializeAccountInfo(deserializer));\n  }\n  return { connectedAccounts };\n}\n\nfunction getState(): DappLocalState {\n  const encodedValue = window.localStorage.getItem(localDappStateKey);\n  return encodedValue\n    ? deserializeLocalDappState(base64ToBytes(encodedValue))\n    : { connectedAccounts: [] };\n}\n\nfunction setState(state: DappLocalState) {\n  const serializedValue = serializeLocalDappState(state);\n  const encodedValue = bytesToBase64(serializedValue);\n  window.localStorage.setItem(localDappStateKey, encodedValue);\n}\n\nexport function getConnectedAccounts() {\n  const state = getState();\n  return state.connectedAccounts;\n}\n\nexport function addConnectedAccount(account: AccountInfo) {\n  const { connectedAccounts, ...state } = getState();\n  connectedAccounts.push(account);\n  setState({ ...state, connectedAccounts });\n}\n\nexport function removeConnectedAccount(address: AccountAddress) {\n  const { connectedAccounts, ...state } = getState();\n  const index = connectedAccounts.findIndex((a) => a.address.equals(address));\n  if (index >= 0) {\n    connectedAccounts.splice(index, 1);\n  }\n  setState({ ...state, connectedAccounts });\n}\n","// Copyright © Aptos\n// SPDX-License-Identifier: Apache-2.0\n\nimport {\n  encodePopupWalletRequest,\n  makePopupWalletRequestChallenge,\n  SerializedWalletRequest,\n  SignedPopupWalletRequest,\n} from '@aptos-connect/wallet-api';\nimport { postEvent as postTelegramEvent } from '@telegram-apps/bridge';\nimport { v4 as randomUUID } from 'uuid';\nimport { createWalletRequest } from './createWalletRequest';\nimport { getClientIdentityKey } from './getClientIdentityKey';\nimport { getWalletResponse } from './getWalletResponse';\n\nexport async function openTelegramPrompt(args: {\n  baseUrl: string;\n  provider?: 'google' | 'apple' | 'generic';\n  request: SerializedWalletRequest;\n  tgWebAppUrl?: string;\n}) {\n  const {\n    baseUrl,\n    provider,\n    request: body,\n    tgWebAppUrl = '/AptosConnectBot/AptosConnect',\n  } = args;\n  const identityKey = getClientIdentityKey();\n  const clientIdentityKey = identityKey.publicKey();\n  const requestId = randomUUID();\n  const timestamp = Date.now();\n\n  const challenge = makePopupWalletRequestChallenge({\n    body,\n    id: requestId,\n    timestamp,\n  });\n  const signature = identityKey.sign(challenge);\n\n  const signedWalletRequest: SignedPopupWalletRequest = {\n    body,\n    clientIdentityKey,\n    id: requestId,\n    signature,\n    timestamp,\n  };\n\n  // Telegram only supports start parameters up to 1024 characters\n  // If the encoded request is longer, we send it to the backend and mark\n  // the request as \"deferred\" by omitting the body\n  let encodedRequest = encodePopupWalletRequest(signedWalletRequest);\n  if (encodedRequest.length > 1024) {\n    void createWalletRequest(baseUrl, signedWalletRequest);\n    encodedRequest = encodePopupWalletRequest({\n      clientIdentityKey,\n      id: requestId,\n      signature,\n      timestamp,\n    });\n  }\n\n  const startParam = `prompt_${provider ?? ''}${encodedRequest}`;\n  postTelegramEvent('web_app_open_tg_link', {\n    path_full: `${tgWebAppUrl}?startapp=${startParam}`,\n  });\n\n  return getWalletResponse(baseUrl, clientIdentityKey, requestId);\n}\n","// Copyright © Aptos\n// SPDX-License-Identifier: Apache-2.0\n\nimport {\n  bytesToBase64,\n  bytesToBase64url,\n  encodeWalletRequestBody,\n  SignedPopupWalletRequest,\n} from '@aptos-connect/wallet-api';\n\nexport async function createWalletRequest(\n  baseUrl: string,\n  request: SignedPopupWalletRequest,\n) {\n  const encodedClientIdentityKey = bytesToBase64url(\n    request.clientIdentityKey.toUint8Array(),\n  );\n\n  const response = await fetch(\n    `${baseUrl}/v1/dapp/clients/${encodedClientIdentityKey}/requests/`,\n    {\n      body: JSON.stringify({\n        body: encodeWalletRequestBody(request.body),\n        id: request.id,\n        signature: bytesToBase64(request.signature.toUint8Array()),\n        timestamp: request.timestamp,\n      }),\n      headers: {\n        Accept: 'application/json',\n        'Content-Type': 'application/json',\n      },\n      method: 'post',\n    },\n  );\n\n  if (!response.ok) {\n    throw new Error('Failed creating the wallet request');\n  }\n}\n","// Copyright © Aptos\n// SPDX-License-Identifier: Apache-2.0\n\nimport { Ed25519PrivateKey } from '@aptos-labs/ts-sdk';\n\nconst identityKeyStorageKey = '@aptos-connect/client-identity-key';\n\nexport function getClientIdentityKey() {\n  const serialized = window.localStorage.getItem(identityKeyStorageKey);\n  if (serialized) {\n    return new Ed25519PrivateKey(serialized);\n  }\n  const identityKey = Ed25519PrivateKey.generate();\n  window.localStorage.setItem(identityKeyStorageKey, identityKey.toString());\n  return identityKey;\n}\n","// Copyright © Aptos\n// SPDX-License-Identifier: Apache-2.0\n\nimport {\n  base64ToBytes,\n  bytesToBase64url,\n  SerializedWalletResponse,\n} from '@aptos-connect/wallet-api';\nimport { Ed25519PublicKey } from '@aptos-labs/ts-sdk';\nimport { smartPolling } from './smartPolling';\n\nexport async function getWalletResponse(\n  baseUrl: string,\n  clientIdentityKey: Ed25519PublicKey,\n  requestId: string,\n): Promise<SerializedWalletResponse> {\n  const encodedClientIdentityKey = bytesToBase64url(\n    clientIdentityKey.toUint8Array(),\n  );\n  const url = new URL(\n    `${baseUrl}/v1/dapp/clients/${encodedClientIdentityKey}/requests/${requestId}/response/`,\n  );\n  const response = await smartPolling(() =>\n    fetch(url, {\n      headers: { Accept: 'application/json' },\n      method: 'get',\n    }),\n  );\n\n  const responseBody = await response.json();\n  const data = base64ToBytes(responseBody.data.body);\n  return { data };\n}\n","// Copyright © Aptos\n// SPDX-License-Identifier: Apache-2.0\n\n/* eslint-disable no-await-in-loop */\n\n/**\n * How long to wait after resuming before trying to fetch the resource again.\n * This gives time for the underlying resource to be persisted.\n */\nconst ON_RESUME_DELAY = 300;\n\n/**\n * How often to poll for the resource when the window is in the foreground.\n * This should typically not be needed, but it's a good fallback in case we\n * can't detect whether the window is in the background\n */\nconst FG_RESPONSE_POLLING_INTERVAL = 2000;\n\n/**\n * Polling interval when the window is in the background.\n * This can be arbitrarily long, but it's still good to keep polling as fallback.\n */\nconst BG_RESPONSE_POLLING_INTERVAL = 3000;\n\n/**\n * Given there's no \"cancel\" mechanism for polling, we should time out the polling after\n * an arbitrarily long time to prevent memory leaks.\n */\nconst POLLING_TIMEOUT = 5 * 60000;\n\nexport interface Timer extends Promise<void> {\n  cancel: () => void;\n}\n\nfunction waitFor(milliseconds: number): Timer {\n  let timeoutId: ReturnType<typeof setTimeout>;\n  let cancel = () => {};\n  const timer = new Promise((resolve) => {\n    timeoutId = setTimeout(resolve, milliseconds);\n    cancel = () => {\n      clearTimeout(timeoutId);\n      resolve();\n    };\n  }) as Timer;\n  timer.cancel = cancel;\n  return timer;\n}\n\n/**\n * Smart polling function that tries to reduce as much as possible the number of requests,\n * while still returning quickly after the resource becomes available.\n */\nexport async function smartPolling(\n  callback: () => Promise<Response>,\n): Promise<Response> {\n  let timer: Timer | undefined;\n  let justResumed = false;\n  let pollingInterval = BG_RESPONSE_POLLING_INTERVAL;\n\n  const onWindowFocus = () => {\n    justResumed = true;\n    pollingInterval = FG_RESPONSE_POLLING_INTERVAL;\n    timer?.cancel();\n  };\n\n  const onWindowBlur = () => {\n    pollingInterval = BG_RESPONSE_POLLING_INTERVAL;\n  };\n\n  window.addEventListener('focus', onWindowFocus);\n  window.addEventListener('blur', onWindowBlur);\n\n  try {\n    const startTime = Date.now();\n    while (Date.now() - startTime < POLLING_TIMEOUT) {\n      timer = waitFor(pollingInterval);\n      await timer;\n\n      if (justResumed) {\n        timer = waitFor(ON_RESUME_DELAY);\n        await timer;\n      }\n\n      const response = await callback();\n      if (response.status === 200) {\n        return response;\n      }\n      justResumed = false;\n    }\n    throw new Error('Timeout');\n  } finally {\n    window.removeEventListener('focus', onWindowFocus);\n    window.removeEventListener('blur', onWindowFocus);\n  }\n}\n","// Copyright © Aptos\n// SPDX-License-Identifier: Apache-2.0\n\nexport function isTelegramMiniApp() {\n  return (window as any).TelegramWebviewProxy !== undefined;\n}\n\nexport * from './openTelegramPrompt';\n"],"mappings":"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","names":["ConnectResponse","bytesToBase64","base64ToBytes","bytesToBase64url","bytesToBase64url","base64ToBytes","ConnectResponse"]}